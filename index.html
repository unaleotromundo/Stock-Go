<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Favicon est√°ndar -->
<link rel="icon" type="image/x-icon" href="favicon.png">
<!-- Android/Chrome -->
<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f4d03f">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Danny's Burger">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danny's Burger - Login</title>
    <link rel="stylesheet" href="styles.css">
    <!-- ‚úÖ Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- ‚úÖ XLSX para exportar a Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.8/xlsx.full.min.js"></script>
</head>
<body data-theme="dark">
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo-circle">
                    <span class="burger-icon">üçî</span>
                </div>
                <div>
                    <h1>DANNY'S</h1>
                    <div class="subtitle">BURGER ‚Ä¢ 2024</div>
                </div>
            </div>
            <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>
        </div>

        <div class="content">
            <div class="section active">
                <h2>üîê Iniciar Sesi√≥n</h2>
                <div class="vintage-decoration">‚óÜ ‚óá ‚óÜ</div>
                
                <form id="loginForm" class="form-group">
                    <div class="modal-form-group">
                        <label for="userType">Nombre de Usuario:</label>
                        <input type="text" id="userType" placeholder="Escribe tu nombre de usuario" required autocomplete="off">
                    </div>
                    <div class="modal-form-group">
                        <label for="password">Contrase√±a:</label>
                        <input type="password" id="password" placeholder="Ingresa la contrase√±a" required>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-gold">Entrar al Sistema</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<div id="particles"></div>

    <script>
        // ‚úÖ Inicializar Supabase desarrollo
        const SUPABASE_URL = 'https://uknsqhlejuxpbnakebdp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrbnNxaGxlanV4cGJuYWtlYmRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Mzg2MDgsImV4cCI6MjA3MzAxNDYwOH0.6QBdfVyZjuGmnSarZ3dvyCnEM06kJfjR7bkvwdoeYEU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

function createParticles() {
    const container = document.getElementById('particles');
    if (!container) return;

    // Limpiar part√≠culas anteriores
    container.innerHTML = '';

    const count = window.innerWidth > 768 ? 30 : 15;

    for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.classList.add('particle');
        
        const size = Math.random() * 4 + 2;
        p.style.width = `${size}px`;
        p.style.height = `${size}px`;
        p.style.left = `${Math.random() * 100}vw`;
        p.style.top = `${Math.random() * 100}vh`; // ‚úÖ ¬°ESTO FALTABA!
        p.style.animationDuration = `${Math.random() * 20 + 10}s`;
        p.style.animationDelay = `${Math.random() * 5}s`;
        p.style.opacity = '0.6';

        container.appendChild(p);
    }
}
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('userType').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showAlert('danger', '‚ùå Completa todos los campos');
                return;
            }

            // ‚úÖ Consultar usuario en Supabase
            const { data, error } = await supabase
                .from('users')
                .select('id, username, role, password')
                .eq('username', username)
                .single();

            if (error || !data) {
                showAlert('danger', '‚ùå Usuario no encontrado');
                return;
            }

            // ‚úÖ Validar contrase√±a (texto plano por ahora, luego lo mejoramos)
            if (data.password !== password) {
                showAlert('danger', '‚ùå Contrase√±a incorrecta');
                return;
            }

            // ‚úÖ Guardar en sessionStorage (igual que antes)
            sessionStorage.setItem('userRole', data.role);
            sessionStorage.setItem('userName', data.username);
            sessionStorage.setItem('userId', data.id);

            // ‚úÖ Redirigir seg√∫n rol
            if (data.role === 'admin') {
                window.location.href = 'admin.html';
            } else {
                window.location.href = 'user.html';
            }
        });

        function showAlert(type, message) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            const container = document.querySelector('.content') || document.body;
            container.insertBefore(alert, container.firstChild);
            setTimeout(() => alert.remove(), 5000);
        }

        document.addEventListener('DOMContentLoaded', createParticles);
    </script>
<!-- PWA Install -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js')
    .then(reg => console.log('‚úÖ Service Worker registrado'))
    .catch(err => console.log('‚ùå Error:', err));
}

// Bot√≥n de instalaci√≥n
let deferredPrompt;
const installButton = document.createElement('button');
installButton.textContent = 'üì≤ Instalar App';
installButton.style.cssText = `
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: linear-gradient(135deg, #f4d03f, #f7dc6f);
  color: #1a1a1a;
  border: none;
  padding: 12px 20px;
  border-radius: 25px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(244, 208, 63, 0.4);
  z-index: 9999;
  display: none;
  font-size: 0.95em;
  transition: all 0.3s ease;
`;
installButton.onmouseover = () => {
  installButton.style.transform = 'translateY(-3px)';
  installButton.style.boxShadow = '0 6px 20px rgba(244, 208, 63, 0.5)';
};
installButton.onmouseout = () => {
  installButton.style.transform = 'translateY(0)';
  installButton.style.boxShadow = '0 4px 15px rgba(244, 208, 63, 0.4)';
};

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installButton.style.display = 'block';
  document.body.appendChild(installButton);
});

installButton.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  console.log(outcome === 'accepted' ? '‚úÖ Instalado' : '‚ùå Cancelado');
  deferredPrompt = null;
  installButton.style.display = 'none';
});

window.addEventListener('appinstalled', () => {
  console.log('üéâ App instalada exitosamente');
  installButton.style.display = 'none';
});
</script>
</body>

</html>
